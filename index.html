<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains the same -->
    <!-- ... -->
</head>
<body>
    <!-- Previous body content remains the same until the script -->
    <!-- ... -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Previous variable declarations remain the same
            // ...

            // Process CSV data
            function processCSV(csvData) {
                const lines = csvData.split('\n').filter(line => line.trim());
                if (lines.length < 2) {
                    throw new Error('CSV file must have at least one header row and one data row');
                }

                // Try both tab and comma delimiters to find which one matches
                let delimiter = '\t'; // default to tab
                const firstLineParts = lines[0].split('\t');
                if (firstLineParts.length < 4) {
                    delimiter = ','; // try comma if tab doesn't give enough columns
                }

                const headers = lines[0].split(delimiter).map(h => h.trim());
                
                // Debug: Show found headers in console
                console.log('Found headers:', headers);
                
                // Find column indices (case sensitive)
                const vulnIdIndex = headers.indexOf('vulnId');
                const resourceIdIndex = headers.indexOf('resourceId');
                const descriptionIndex = headers.indexOf('description');
                const severityIndex = headers.indexOf('severity');
                
                if (vulnIdIndex === -1 || resourceIdIndex === -1 || descriptionIndex === -1 || severityIndex === -1) {
                    const missingColumns = [
                        vulnIdIndex === -1 ? 'vulnId' : null,
                        resourceIdIndex === -1 ? 'resourceId' : null,
                        descriptionIndex === -1 ? 'description' : null,
                        severityIndex === -1 ? 'severity' : null
                    ].filter(Boolean);
                    
                    throw new Error(
                        `Required columns not found. Missing: ${missingColumns.join(', ')}\n` +
                        `Found columns: ${headers.join(', ')}\n` +
                        `Using delimiter: ${delimiter === '\t' ? 'tab' : 'comma'}`
                    );
                }
                
                const results = [];
                
                for (let i = 1; i < lines.length; i++) {
                    if (!lines[i].trim()) continue;
                    
                    const values = lines[i].split(delimiter);
                    const vulnId = values[vulnIdIndex]?.trim();
                    const resourceId = values[resourceIdIndex]?.trim();
                    const description = values[descriptionIndex]?.trim();
                    const severity = values[severityIndex]?.trim();
                    
                    if (!vulnId || !resourceId || !description) continue;
                    
                    // Process service name
                    let serviceName = extractServiceName(resourceId);
                    
                    // Extract vulnerable package from description
                    const vulnerablePackage = extractVulnerablePackage(description);
                    
                    results.push({
                        serialNumber: i,
                        serviceName: serviceName,
                        cveId: vulnId,
                        severity: severity,
                        vulnerablePackage: vulnerablePackage
                    });
                }
                
                // Sort by service name
                results.sort((a, b) => a.serviceName.localeCompare(b.serviceName));
                
                return results;
            }

            // Rest of the code remains the same
            // ...
        });
    </script>
</body>
</html>
